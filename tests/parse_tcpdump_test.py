from src.tcpdump import hex_from_tcpdump

def test_tcpdump_to_raw_hex():
    lines = [
        "03:11:31.128677 IP6 localhost.55752 > localhost.8303: UDP, length 8",
        "        0x0000:  6004 33b1 0010 1140 0000 0000 0000 0000  `.3....@........",
        "        0x0010:  0000 0000 0000 0001 0000 0000 0000 0000  ................",
        "        0x0020:  0000 0000 0000 0001 d9c8 206f 0010 0023  ...........o...#",
        "        0x0030:  040f 0026 3e5a 3704                      ...&>Z7."
    ]
    hex = [
        '6004 33b1 0010 1140 0000 0000 0000 0000',
        '0000 0000 0000 0001 0000 0000 0000 0000',
        '0000 0000 0000 0001 d9c8 206f 0010 0023',
        '040f 0026 3e5a 3704'
    ]
    assert hex_from_tcpdump(lines) == hex

def test_broken_tcpdump_to_raw_hex():
    lines = [
        "03:11:31.128677 IP6 localhost.55752 > localhost.8303: UDP, length 8",
        "        0x0000:  6004 33b1 0010 1140 0000 0000 0000 0000 1111 `.3....@........",
        "        0x0010:  0000 0000 0000 0001 0000 0000 0000 0000 2222 3333  ................",
        "        0x0020:  0000 0000 0000 0001 d9c8 206f 0010 0023  ...........o...#",
        "        0x0030:  040f 0026 3e5a 3704                      ...&>Z7."
    ]
    hex = [
        '6004 33b1 0010 1140 0000 0000 0000 0000',
        '0000 0000 0000 0001 0000 0000 0000 0000',
        '0000 0000 0000 0001 d9c8 206f 0010 0023',
        '040f 0026 3e5a 3704'
    ]
    assert hex_from_tcpdump(lines) == hex

def test_no_ascii_tcpdump_to_raw_hex():
    lines = [
        "03:11:31.128677 IP6 localhost.55752 > localhost.8303: UDP, length 8",
        "        0x0000:  6004 33b1 0010 1140 0000 0000 0000 0000",
        "        0x0010:  0000 0000 0000 0001 0000 0000 0000 0000",
        "        0x0020:  0000 0000 0000 0001 d9c8 206f 0010 0023",
        "        0x0030:  040f 0026 3e5a 3704"
    ]
    hex = [
        '6004 33b1 0010 1140 0000 0000 0000 0000',
        '0000 0000 0000 0001 0000 0000 0000 0000',
        '0000 0000 0000 0001 d9c8 206f 0010 0023',
        '040f 0026 3e5a 3704'
    ]
    assert hex_from_tcpdump(lines) == hex

def test_single_bytes_in_the_end():
    lines = [
        "03:11:31.106564 IP6 localhost.8303 > localhost.55752: UDP, length 21",
        "0x0000:  600a a56d 001d 1140 0000 0000 0000 0000",
        "0x0010:  0000 0000 0000 0001 0000 0000 0000 0000",
        "0x0020:  0000 0000 0000 0001 206f d9c8 001d 0030",
        "0x0030:  0019 0223 ec92 0300 0515 9ea0 050c 0005",
        "0x0040:  0f9e a005 02"
    ]
    hex = [
        "600a a56d 001d 1140 0000 0000 0000 0000",
        "0000 0000 0000 0001 0000 0000 0000 0000",
        "0000 0000 0000 0001 206f d9c8 001d 0030",
        "0019 0223 ec92 0300 0515 9ea0 050c 0005",
        "0f9e a005 02"
    ]
    assert hex_from_tcpdump(lines) == hex

